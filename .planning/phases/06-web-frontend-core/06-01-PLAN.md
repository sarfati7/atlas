---
phase: 06-web-frontend-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/vite.config.ts
  - frontend/tsconfig.json
  - frontend/index.html
  - frontend/src/main.tsx
  - frontend/src/App.tsx
  - frontend/src/routes/router.tsx
  - frontend/src/index.css
  - frontend/src/lib/api.ts
  - frontend/src/lib/queryClient.ts
  - frontend/src/lib/utils.ts
  - frontend/src/vite-env.d.ts
  - frontend/components.json
  - frontend/.env.example
autonomous: true

must_haves:
  truths:
    - "npm run dev starts Vite dev server without errors"
    - "TypeScript compiles with no errors"
    - "Tailwind dark theme variables are applied to page"
    - "shadcn/ui components are installable via CLI"
    - "createBrowserRouter is used for all routing"
  artifacts:
    - path: "frontend/package.json"
      provides: "Project dependencies"
      contains: "react"
    - path: "frontend/vite.config.ts"
      provides: "Vite configuration with path aliases"
      contains: "@/"
    - path: "frontend/src/routes/router.tsx"
      provides: "Centralized router configuration using createBrowserRouter"
      contains: "createBrowserRouter"
    - path: "frontend/src/lib/api.ts"
      provides: "Axios client with token refresh interceptor"
      contains: "interceptors.response"
    - path: "frontend/src/lib/queryClient.ts"
      provides: "TanStack Query client configuration"
      contains: "QueryClient"
    - path: "frontend/src/index.css"
      provides: "Tailwind with dark theme CSS variables"
      contains: "--background"
  key_links:
    - from: "frontend/src/main.tsx"
      to: "frontend/src/lib/queryClient.ts"
      via: "QueryClientProvider wrapping App"
      pattern: "QueryClientProvider"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/routes/router.tsx"
      via: "RouterProvider using exported router"
      pattern: "RouterProvider.*router"
    - from: "frontend/src/lib/api.ts"
      to: "/api/v1/auth/refresh"
      via: "axios interceptor for 401 handling"
      pattern: "auth/refresh"
---

<objective>
Set up React frontend project with Vite, TanStack Query, and shadcn/ui foundation.

Purpose: Establish the frontend infrastructure that all subsequent plans build upon - build tooling, API client with automatic token refresh, dark theme styling, and centralized routing with createBrowserRouter.

Output: A working Vite + React + TypeScript project with TanStack Query configured, axios client with refresh token interceptor, shadcn/ui initialized with dark theme, and a router.tsx file using createBrowserRouter that subsequent plans will extend.
</objective>

<execution_context>
@~/.claude/agents/gsd-executor.md
@~/.claude/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-web-frontend-core/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vite React project with core dependencies</name>
  <files>
    frontend/package.json
    frontend/vite.config.ts
    frontend/tsconfig.json
    frontend/tsconfig.node.json
    frontend/index.html
    frontend/src/main.tsx
    frontend/src/vite-env.d.ts
    frontend/.env.example
    frontend/.gitignore
  </files>
  <action>
Create the frontend project using Vite template and install dependencies:

1. Create project: `npm create vite@latest frontend -- --template react-ts`
2. Install core dependencies:
   ```
   npm install react-router-dom @tanstack/react-query zustand react-hook-form zod @hookform/resolvers axios
   ```
3. Install dev dependencies:
   ```
   npm install -D @tanstack/react-query-devtools tailwindcss @tailwindcss/vite @types/node
   ```

4. Update vite.config.ts to add path alias:
   ```typescript
   import { defineConfig } from 'vite'
   import react from '@vitejs/plugin-react'
   import tailwindcss from '@tailwindcss/vite'
   import path from 'path'

   export default defineConfig({
     plugins: [react(), tailwindcss()],
     resolve: {
       alias: {
         '@': path.resolve(__dirname, './src'),
       },
     },
     server: {
       proxy: {
         '/api': {
           target: 'http://localhost:8000',
           changeOrigin: true,
         },
       },
     },
   })
   ```

5. Update tsconfig.json to add path mapping:
   ```json
   {
     "compilerOptions": {
       "baseUrl": ".",
       "paths": {
         "@/*": ["./src/*"]
       }
     }
   }
   ```

6. Create .env.example:
   ```
   VITE_API_BASE_URL=http://localhost:8000
   VITE_APP_NAME=Atlas
   ```

7. Update vite-env.d.ts to type environment variables:
   ```typescript
   /// <reference types="vite/client" />

   interface ImportMetaEnv {
     readonly VITE_API_BASE_URL: string
     readonly VITE_APP_NAME: string
   }

   interface ImportMeta {
     readonly env: ImportMetaEnv
   }
   ```
  </action>
  <verify>
    cd frontend && npm run build && npm run dev -- --host 0.0.0.0 --port 5173 &
    sleep 3 && curl -s http://localhost:5173 | grep -q "Atlas" && echo "OK" || echo "FAIL"
    kill %1
  </verify>
  <done>Vite dev server starts, TypeScript compiles, page renders</done>
</task>

<task type="auto">
  <name>Task 2: Set up Tailwind CSS with dark theme and shadcn/ui</name>
  <files>
    frontend/src/index.css
    frontend/components.json
    frontend/src/lib/utils.ts
  </files>
  <action>
Configure Tailwind with dark-only theme using CSS variables (shadcn/ui pattern):

1. Create src/index.css with dark theme variables:
   ```css
   @import "tailwindcss";

   @layer base {
     :root {
       --background: 224 71% 4%;
       --foreground: 213 31% 91%;
       --card: 224 71% 4%;
       --card-foreground: 213 31% 91%;
       --popover: 224 71% 4%;
       --popover-foreground: 213 31% 91%;
       --primary: 210 40% 98%;
       --primary-foreground: 222.2 47.4% 1.2%;
       --secondary: 222.2 47.4% 11.2%;
       --secondary-foreground: 210 40% 98%;
       --muted: 223 47% 11%;
       --muted-foreground: 215.4 16.3% 56.9%;
       --accent: 216 34% 17%;
       --accent-foreground: 210 40% 98%;
       --destructive: 0 63% 31%;
       --destructive-foreground: 210 40% 98%;
       --border: 216 34% 17%;
       --input: 216 34% 17%;
       --ring: 216 34% 17%;
       --radius: 0.5rem;
     }
   }

   @layer base {
     * {
       @apply border-border;
     }
     body {
       @apply bg-background text-foreground;
       font-feature-settings: "rlig" 1, "calt" 1;
     }
   }
   ```

2. Initialize shadcn/ui (creates components.json):
   ```bash
   npx shadcn@latest init -y --defaults
   ```

   If prompted, select:
   - Style: Default
   - Base color: Slate
   - CSS variables: yes

3. Create src/lib/utils.ts for class merging:
   ```typescript
   import { type ClassValue, clsx } from "clsx"
   import { twMerge } from "tailwind-merge"

   export function cn(...inputs: ClassValue[]) {
     return twMerge(clsx(inputs))
   }
   ```

4. Install clsx and tailwind-merge:
   ```bash
   npm install clsx tailwind-merge
   ```

5. Verify components.json exists and points to correct paths.
  </action>
  <verify>
    cd frontend && npx shadcn@latest add button --yes
    # Check button component was created
    ls src/components/ui/button.tsx && echo "shadcn OK" || echo "shadcn FAIL"
  </verify>
  <done>Tailwind dark theme applies, shadcn components installable</done>
</task>

<task type="auto">
  <name>Task 3: Create API client, TanStack Query, and router foundation</name>
  <files>
    frontend/src/lib/api.ts
    frontend/src/lib/queryClient.ts
    frontend/src/routes/router.tsx
    frontend/src/App.tsx
    frontend/src/main.tsx
  </files>
  <action>
Create axios client with token refresh interceptor, TanStack Query setup, and centralized router:

1. Create src/lib/api.ts:
   ```typescript
   import axios from 'axios'

   export const apiClient = axios.create({
     baseURL: import.meta.env.VITE_API_BASE_URL || '',
     withCredentials: true, // Include httpOnly cookies
   })

   // Track if we're currently refreshing to prevent multiple refresh calls
   let isRefreshing = false
   let failedQueue: Array<{
     resolve: (token: string | null) => void
     reject: (error: unknown) => void
   }> = []

   const processQueue = (error: unknown | null) => {
     failedQueue.forEach((prom) => {
       if (error) {
         prom.reject(error)
       } else {
         prom.resolve(null)
       }
     })
     failedQueue = []
   }

   // Response interceptor for token refresh
   apiClient.interceptors.response.use(
     (response) => response,
     async (error) => {
       const originalRequest = error.config

       // If 401 and haven't retried yet
       if (error.response?.status === 401 && !originalRequest._retry) {
         if (isRefreshing) {
           // If already refreshing, queue this request
           return new Promise((resolve, reject) => {
             failedQueue.push({ resolve, reject })
           }).then(() => {
             return apiClient(originalRequest)
           })
         }

         originalRequest._retry = true
         isRefreshing = true

         try {
           // Refresh token endpoint (uses httpOnly cookie)
           await axios.post('/api/v1/auth/refresh', {}, { withCredentials: true })

           processQueue(null)

           // Retry original request
           return apiClient(originalRequest)
         } catch (refreshError) {
           processQueue(refreshError)

           // Refresh failed - clear auth state and redirect to login
           // The auth store will handle this
           window.dispatchEvent(new CustomEvent('auth:logout'))

           return Promise.reject(refreshError)
         } finally {
           isRefreshing = false
         }
       }

       return Promise.reject(error)
     }
   )
   ```

2. Create src/lib/queryClient.ts:
   ```typescript
   import { QueryClient } from '@tanstack/react-query'

   export const queryClient = new QueryClient({
     defaultOptions: {
       queries: {
         staleTime: 1000 * 60 * 5, // 5 minutes
         gcTime: 1000 * 60 * 10, // 10 minutes
         retry: 1,
         refetchOnWindowFocus: false,
       },
     },
   })
   ```

3. Create src/routes/router.tsx - the centralized router that all plans will extend:
   ```typescript
   import { createBrowserRouter, Navigate } from 'react-router-dom'

   /**
    * Centralized router configuration using createBrowserRouter.
    *
    * CRITICAL: This file is the single source of truth for all routes.
    * All subsequent plans (06-02, 06-03, 06-04, 06-05) will MODIFY this file
    * by importing route components and adding them to the routes array below.
    *
    * DO NOT replace this file or create a new routing structure in App.tsx.
    * ALWAYS extend this router configuration by adding new route objects.
    *
    * Route structure:
    * - Auth routes (no layout): /login, /signup, /reset-password
    * - App routes (with RootLayout): /catalog, /catalog/:id, /dashboard, /settings
    */
   export const router = createBrowserRouter([
     // Placeholder - auth routes will be added by 06-02
     // Placeholder - app routes with RootLayout will be added by 06-03

     // Default redirect to catalog
     {
       path: '/',
       element: <Navigate to="/catalog" replace />,
     },

     // Temporary placeholder routes until plans complete them
     {
       path: '/login',
       element: <div className="min-h-screen flex items-center justify-center bg-background text-foreground">Login (coming in 06-02)</div>,
     },
     {
       path: '/catalog',
       element: <div className="min-h-screen flex items-center justify-center bg-background text-foreground">Catalog (coming in 06-03)</div>,
     },
   ])
   ```

4. Create src/App.tsx that uses RouterProvider:
   ```typescript
   import { RouterProvider } from 'react-router-dom'
   import { router } from './routes/router'

   function App() {
     return <RouterProvider router={router} />
   }

   export default App
   ```

5. Update src/main.tsx to wrap with QueryClientProvider:
   ```typescript
   import { StrictMode } from 'react'
   import { createRoot } from 'react-dom/client'
   import { QueryClientProvider } from '@tanstack/react-query'
   import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
   import { queryClient } from './lib/queryClient'
   import App from './App'
   import './index.css'

   createRoot(document.getElementById('root')!).render(
     <StrictMode>
       <QueryClientProvider client={queryClient}>
         <App />
         <ReactQueryDevtools initialIsOpen={false} />
       </QueryClientProvider>
     </StrictMode>
   )
   ```
  </action>
  <verify>
    cd frontend && npm run build
    # Check for no TypeScript errors
    echo $? && echo "Build OK" || echo "Build FAIL"
    # Check router uses createBrowserRouter
    grep -r "createBrowserRouter" src/routes/router.tsx && echo "Router OK"
  </verify>
  <done>API client with refresh interceptor works, QueryClientProvider wraps app, createBrowserRouter foundation in place</done>
</task>

</tasks>

<verification>
- `cd frontend && npm run build` completes without TypeScript errors
- `cd frontend && npm run dev` starts dev server on port 5173
- Page renders with dark background (bg-background applies)
- `npx shadcn@latest add card` installs card component successfully
- src/lib/api.ts exports apiClient with interceptors configured
- src/routes/router.tsx uses createBrowserRouter (not BrowserRouter)
- src/App.tsx uses RouterProvider with router from router.tsx
</verification>

<success_criteria>
1. Vite dev server starts and serves React app
2. TypeScript compiles with strict mode, no errors
3. Tailwind CSS dark theme variables are applied
4. TanStack Query DevTools appear in development
5. Axios client has token refresh interceptor
6. Path alias @/ resolves correctly
7. shadcn/ui components can be added via CLI
8. Router uses createBrowserRouter (not BrowserRouter with Routes/Route)
9. App.tsx uses RouterProvider
</success_criteria>

<output>
After completion, create `.planning/phases/06-web-frontend-core/06-01-SUMMARY.md`
</output>
