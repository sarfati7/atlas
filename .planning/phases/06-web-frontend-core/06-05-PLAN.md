---
phase: 06-web-frontend-core
plan: 05
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - frontend/src/features/profile/api/profileApi.ts
  - frontend/src/features/profile/hooks/useProfile.ts
  - frontend/src/features/profile/types.ts
  - frontend/src/features/profile/components/DashboardStats.tsx
  - frontend/src/features/profile/components/AvailableItems.tsx
  - frontend/src/features/profile/components/ConfigurationPreview.tsx
  - frontend/src/routes/dashboard.tsx
  - frontend/src/lib/loaders.ts
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can view their dashboard when logged in"
    - "Dashboard shows user stats (teams, items, config status)"
    - "Dashboard shows available catalog items summary"
    - "Unauthenticated users are redirected to login"
  artifacts:
    - path: "frontend/src/features/profile/api/profileApi.ts"
      provides: "Profile API calls"
      exports: ["profileApi"]
    - path: "frontend/src/features/profile/hooks/useProfile.ts"
      provides: "Profile hooks"
      exports: ["useDashboard"]
    - path: "frontend/src/routes/dashboard.tsx"
      provides: "Dashboard page"
      contains: "DashboardPage"
    - path: "frontend/src/lib/loaders.ts"
      provides: "Route loaders for protected routes"
      exports: ["protectedLoader"]
  key_links:
    - from: "frontend/src/routes/dashboard.tsx"
      to: "frontend/src/features/profile/hooks/useProfile.ts"
      via: "useDashboard hook for data fetching"
      pattern: "useDashboard"
    - from: "frontend/src/lib/loaders.ts"
      to: "/api/v1/auth/me"
      via: "Check authentication before rendering"
      pattern: "auth/me"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/lib/loaders.ts"
      via: "Dashboard route uses protectedLoader"
      pattern: "protectedLoader"
---

<objective>
Implement user dashboard page with stats and configuration preview.

Purpose: Enable authenticated users to view their personal dashboard showing team memberships, available items count, and configuration status.

Output: Working dashboard page that requires authentication, shows user stats, and displays a summary of available catalog items.
</objective>

<execution_context>
@~/.claude/agents/gsd-executor.md
@~/.claude/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-web-frontend-core/06-CONTEXT.md
@.planning/phases/06-web-frontend-core/06-02-SUMMARY.md
@backend/src/atlas/entrypoints/api/routes/profile.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile API layer and hooks</name>
  <files>
    frontend/src/features/profile/types.ts
    frontend/src/features/profile/api/profileApi.ts
    frontend/src/features/profile/hooks/useProfile.ts
  </files>
  <action>
Create profile feature with API layer and TanStack Query hooks:

1. Create src/features/profile/types.ts:
   ```typescript
   import type { CatalogItemSummary, CatalogItemType } from '@/features/catalog/types'

   export interface DashboardData {
     user_id: string
     username: string
     teams: Team[]
     available_items_count: {
       skills: number
       mcps: number
       tools: number
       total: number
     }
     has_configuration: boolean
   }

   export interface Team {
     id: string
     name: string
     role: string
   }

   export interface EffectiveConfiguration {
     content: string
     org_applied: boolean
     team_applied: boolean
     user_applied: boolean
   }

   export interface AvailableItem extends CatalogItemSummary {}
   ```

2. Create src/features/profile/api/profileApi.ts:
   ```typescript
   import { apiClient } from '@/lib/api'
   import type { DashboardData, EffectiveConfiguration, AvailableItem } from '../types'
   import type { CatalogItemType } from '@/features/catalog/types'

   export const profileApi = {
     getDashboard: async (): Promise<DashboardData> => {
       const response = await apiClient.get('/api/v1/profile/dashboard')
       return response.data
     },

     getAvailableItems: async (type?: CatalogItemType): Promise<AvailableItem[]> => {
       const params = type ? { type } : {}
       const response = await apiClient.get('/api/v1/profile/available-items', { params })
       return response.data
     },

     getEffectiveConfiguration: async (): Promise<EffectiveConfiguration> => {
       const response = await apiClient.get('/api/v1/profile/effective-configuration')
       return response.data
     },
   }
   ```

3. Create src/features/profile/hooks/useProfile.ts:
   ```typescript
   import { useQuery } from '@tanstack/react-query'
   import { profileApi } from '../api/profileApi'
   import type { CatalogItemType } from '@/features/catalog/types'

   export const useDashboard = () => {
     return useQuery({
       queryKey: ['profile', 'dashboard'],
       queryFn: profileApi.getDashboard,
     })
   }

   export const useAvailableItems = (type?: CatalogItemType) => {
     return useQuery({
       queryKey: ['profile', 'available-items', type],
       queryFn: () => profileApi.getAvailableItems(type),
     })
   }

   export const useEffectiveConfiguration = () => {
     return useQuery({
       queryKey: ['profile', 'effective-configuration'],
       queryFn: profileApi.getEffectiveConfiguration,
     })
   }
   ```

4. Create index file:
   ```typescript
   // src/features/profile/index.ts
   export * from './types'
   export * from './api/profileApi'
   export * from './hooks/useProfile'
   ```
  </action>
  <verify>
    cd frontend && npm run build
    grep -r "useDashboard" src/features/profile/hooks/useProfile.ts && echo "Hooks OK"
    grep -r "profileApi" src/features/profile/api/profileApi.ts && echo "API OK"
  </verify>
  <done>Profile API layer and TanStack Query hooks created</done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard UI components</name>
  <files>
    frontend/src/features/profile/components/DashboardStats.tsx
    frontend/src/features/profile/components/AvailableItems.tsx
    frontend/src/features/profile/components/ConfigurationPreview.tsx
    frontend/src/features/profile/components/index.ts
  </files>
  <action>
Create dashboard UI components:

1. Create src/features/profile/components/DashboardStats.tsx:
   ```typescript
   import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
   import { Skeleton } from '@/components/ui/skeleton'
   import { Users, Wrench, Puzzle, Code, FileText } from 'lucide-react'
   import type { DashboardData } from '../types'

   interface DashboardStatsProps {
     data: DashboardData
   }

   export function DashboardStats({ data }: DashboardStatsProps) {
     const stats = [
       {
         label: 'Teams',
         value: data.teams.length,
         icon: Users,
         color: 'text-blue-400',
       },
       {
         label: 'Skills',
         value: data.available_items_count.skills,
         icon: Code,
         color: 'text-emerald-400',
       },
       {
         label: 'MCPs',
         value: data.available_items_count.mcps,
         icon: Puzzle,
         color: 'text-violet-400',
       },
       {
         label: 'Tools',
         value: data.available_items_count.tools,
         icon: Wrench,
         color: 'text-amber-400',
       },
     ]

     return (
       <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
         {stats.map((stat) => {
           const Icon = stat.icon
           return (
             <Card key={stat.label}>
               <CardHeader className="flex flex-row items-center justify-between pb-2">
                 <CardTitle className="text-sm font-medium text-muted-foreground">
                   {stat.label}
                 </CardTitle>
                 <Icon className={`h-4 w-4 ${stat.color}`} />
               </CardHeader>
               <CardContent>
                 <div className="text-2xl font-bold">{stat.value}</div>
               </CardContent>
             </Card>
           )
         })}
       </div>
     )
   }

   export function DashboardStatsSkeleton() {
     return (
       <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
         {Array.from({ length: 4 }).map((_, i) => (
           <Card key={i}>
             <CardHeader className="flex flex-row items-center justify-between pb-2">
               <Skeleton className="h-4 w-16" />
               <Skeleton className="h-4 w-4" />
             </CardHeader>
             <CardContent>
               <Skeleton className="h-8 w-12" />
             </CardContent>
           </Card>
         ))}
       </div>
     )
   }
   ```

2. Create src/features/profile/components/AvailableItems.tsx:
   ```typescript
   import { Link } from 'react-router-dom'
   import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
   import { Badge } from '@/components/ui/badge'
   import { Button } from '@/components/ui/button'
   import { Skeleton } from '@/components/ui/skeleton'
   import { ArrowRight } from 'lucide-react'
   import { useAvailableItems } from '../hooks/useProfile'
   import type { CatalogItemType } from '@/features/catalog/types'

   const typeColors: Record<CatalogItemType, string> = {
     SKILL: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
     MCP: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
     TOOL: 'bg-amber-500/10 text-amber-400 border-amber-500/20',
   }

   const typeLabels: Record<CatalogItemType, string> = {
     SKILL: 'Skill',
     MCP: 'MCP',
     TOOL: 'Tool',
   }

   export function AvailableItems() {
     const { data: items, isLoading, isError } = useAvailableItems()

     if (isLoading) {
       return <AvailableItemsSkeleton />
     }

     if (isError) {
       return (
         <Card>
           <CardContent className="py-6 text-center text-muted-foreground">
             Failed to load available items
           </CardContent>
         </Card>
       )
     }

     const recentItems = items?.slice(0, 6) ?? []

     return (
       <Card>
         <CardHeader className="flex flex-row items-center justify-between">
           <div>
             <CardTitle>Available Items</CardTitle>
             <CardDescription>
               Skills, MCPs, and tools available to you
             </CardDescription>
           </div>
           <Link to="/catalog">
             <Button variant="ghost" size="sm" className="gap-2">
               View all
               <ArrowRight className="h-4 w-4" />
             </Button>
           </Link>
         </CardHeader>
         <CardContent>
           {recentItems.length === 0 ? (
             <div className="text-center py-6 text-muted-foreground">
               No items available yet
             </div>
           ) : (
             <div className="space-y-3">
               {recentItems.map((item) => (
                 <Link
                   key={item.id}
                   to={`/catalog/${item.id}`}
                   className="flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors"
                 >
                   <div className="min-w-0 flex-1">
                     <div className="flex items-center gap-2">
                       <span className="font-medium truncate">{item.name}</span>
                       <Badge variant="outline" className={typeColors[item.type]}>
                         {typeLabels[item.type]}
                       </Badge>
                     </div>
                     <p className="text-sm text-muted-foreground truncate mt-0.5">
                       {item.description}
                     </p>
                   </div>
                 </Link>
               ))}
             </div>
           )}
         </CardContent>
       </Card>
     )
   }

   function AvailableItemsSkeleton() {
     return (
       <Card>
         <CardHeader className="flex flex-row items-center justify-between">
           <div>
             <Skeleton className="h-6 w-32" />
             <Skeleton className="h-4 w-48 mt-1" />
           </div>
           <Skeleton className="h-8 w-20" />
         </CardHeader>
         <CardContent>
           <div className="space-y-3">
             {Array.from({ length: 4 }).map((_, i) => (
               <div key={i} className="p-3 rounded-lg bg-muted/50">
                 <div className="flex items-center gap-2">
                   <Skeleton className="h-5 w-32" />
                   <Skeleton className="h-5 w-12" />
                 </div>
                 <Skeleton className="h-4 w-48 mt-2" />
               </div>
             ))}
           </div>
         </CardContent>
       </Card>
     )
   }
   ```

3. Create src/features/profile/components/ConfigurationPreview.tsx:
   ```typescript
   import { Link } from 'react-router-dom'
   import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
   import { Button } from '@/components/ui/button'
   import { Badge } from '@/components/ui/badge'
   import { Skeleton } from '@/components/ui/skeleton'
   import { Settings, CheckCircle, XCircle } from 'lucide-react'
   import { useEffectiveConfiguration } from '../hooks/useProfile'

   export function ConfigurationPreview() {
     const { data: config, isLoading, isError } = useEffectiveConfiguration()

     if (isLoading) {
       return <ConfigurationPreviewSkeleton />
     }

     if (isError) {
       return (
         <Card>
           <CardContent className="py-6 text-center text-muted-foreground">
             Failed to load configuration
           </CardContent>
         </Card>
       )
     }

     const inheritanceSources = [
       { label: 'Organization', applied: config?.org_applied ?? false },
       { label: 'Team', applied: config?.team_applied ?? false },
       { label: 'Personal', applied: config?.user_applied ?? false },
     ]

     return (
       <Card>
         <CardHeader className="flex flex-row items-center justify-between">
           <div>
             <CardTitle>Configuration</CardTitle>
             <CardDescription>
               Your effective claude.md configuration
             </CardDescription>
           </div>
           <Link to="/settings">
             <Button variant="outline" size="sm" className="gap-2">
               <Settings className="h-4 w-4" />
               Edit
             </Button>
           </Link>
         </CardHeader>
         <CardContent className="space-y-4">
           {/* Inheritance status */}
           <div className="flex flex-wrap gap-2">
             {inheritanceSources.map((source) => (
               <div
                 key={source.label}
                 className="flex items-center gap-1.5 text-sm"
               >
                 {source.applied ? (
                   <CheckCircle className="h-4 w-4 text-emerald-400" />
                 ) : (
                   <XCircle className="h-4 w-4 text-muted-foreground" />
                 )}
                 <span className={source.applied ? 'text-foreground' : 'text-muted-foreground'}>
                   {source.label}
                 </span>
               </div>
             ))}
           </div>

           {/* Config preview */}
           {config?.content ? (
             <div className="bg-muted rounded-lg p-4 max-h-48 overflow-y-auto">
               <pre className="text-sm font-mono whitespace-pre-wrap">
                 {config.content.slice(0, 500)}
                 {config.content.length > 500 && '...'}
               </pre>
             </div>
           ) : (
             <div className="text-center py-6 text-muted-foreground">
               <p>No configuration set up yet</p>
               <Link to="/settings">
                 <Button variant="link" className="mt-2">
                   Set up your configuration
                 </Button>
               </Link>
             </div>
           )}
         </CardContent>
       </Card>
     )
   }

   function ConfigurationPreviewSkeleton() {
     return (
       <Card>
         <CardHeader className="flex flex-row items-center justify-between">
           <div>
             <Skeleton className="h-6 w-28" />
             <Skeleton className="h-4 w-48 mt-1" />
           </div>
           <Skeleton className="h-8 w-16" />
         </CardHeader>
         <CardContent className="space-y-4">
           <div className="flex gap-4">
             <Skeleton className="h-5 w-24" />
             <Skeleton className="h-5 w-16" />
             <Skeleton className="h-5 w-20" />
           </div>
           <Skeleton className="h-32 w-full rounded-lg" />
         </CardContent>
       </Card>
     )
   }
   ```

4. Create index file:
   ```typescript
   // src/features/profile/components/index.ts
   export { DashboardStats, DashboardStatsSkeleton } from './DashboardStats'
   export { AvailableItems } from './AvailableItems'
   export { ConfigurationPreview } from './ConfigurationPreview'
   ```
  </action>
  <verify>
    cd frontend && npm run build
    ls src/features/profile/components/DashboardStats.tsx && echo "Components OK"
  </verify>
  <done>Dashboard UI components created</done>
</task>

<task type="auto">
  <name>Task 3: Create protected loader and dashboard page</name>
  <files>
    frontend/src/lib/loaders.ts
    frontend/src/routes/dashboard.tsx
    frontend/src/App.tsx
  </files>
  <action>
Create route protection and dashboard page:

1. Create src/lib/loaders.ts:
   ```typescript
   import { redirect } from 'react-router-dom'
   import { queryClient } from './queryClient'
   import { useAuthStore } from '@/stores/authStore'

   export const protectedLoader = async () => {
     const { isAuthenticated, accessToken } = useAuthStore.getState()

     // Quick check - if no token stored, redirect immediately
     if (!isAuthenticated || !accessToken) {
       throw redirect('/login')
     }

     // Verify token is still valid by checking /me endpoint
     try {
       await queryClient.ensureQueryData({
         queryKey: ['auth', 'me'],
         queryFn: async () => {
           const response = await fetch('/api/v1/auth/me', {
             headers: {
               Authorization: `Bearer ${accessToken}`,
             },
             credentials: 'include',
           })
           if (!response.ok) throw new Error('Not authenticated')
           return response.json()
         },
       })
       return null
     } catch {
       // Token invalid, clear auth state and redirect
       useAuthStore.getState().logout()
       throw redirect('/login')
     }
   }

   // Loader for routes that redirect if already authenticated
   export const guestLoader = async () => {
     const { isAuthenticated } = useAuthStore.getState()

     if (isAuthenticated) {
       throw redirect('/dashboard')
     }

     return null
   }
   ```

2. Create src/routes/dashboard.tsx:
   ```typescript
   import { useDashboard } from '@/features/profile/hooks/useProfile'
   import {
     DashboardStats,
     DashboardStatsSkeleton,
     AvailableItems,
     ConfigurationPreview,
   } from '@/features/profile/components'
   import { useCurrentUser } from '@/features/auth/hooks/useAuth'

   export function DashboardPage() {
     const { data: user } = useCurrentUser()
     const { data: dashboardData, isLoading, isError } = useDashboard()

     return (
       <div className="p-6 space-y-6">
         {/* Header */}
         <div>
           <h1 className="text-3xl font-bold">
             Welcome back{user ? `, ${user.username}` : ''}
           </h1>
           <p className="text-muted-foreground mt-1">
             Here's an overview of your Atlas configuration
           </p>
         </div>

         {/* Stats */}
         {isLoading ? (
           <DashboardStatsSkeleton />
         ) : isError || !dashboardData ? (
           <div className="text-center py-6 text-destructive">
             Failed to load dashboard data
           </div>
         ) : (
           <DashboardStats data={dashboardData} />
         )}

         {/* Main content grid */}
         <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
           <AvailableItems />
           <ConfigurationPreview />
         </div>
       </div>
     )
   }
   ```

3. Update src/App.tsx with protected routes:
   ```typescript
   import { createBrowserRouter, RouterProvider } from 'react-router-dom'
   import { RootLayout } from './components/layout/RootLayout'
   import { LoginPage } from './routes/login'
   import { SignupPage } from './routes/signup'
   import { ResetPasswordPage } from './routes/reset-password'
   import { CatalogPage } from './routes/catalog'
   import { CatalogDetailPage } from './routes/catalog-detail'
   import { DashboardPage } from './routes/dashboard'
   import { protectedLoader, guestLoader } from './lib/loaders'

   const router = createBrowserRouter([
     {
       path: '/login',
       element: <LoginPage />,
       loader: guestLoader,
     },
     {
       path: '/signup',
       element: <SignupPage />,
       loader: guestLoader,
     },
     {
       path: '/reset-password',
       element: <ResetPasswordPage />,
     },
     {
       path: '/',
       element: <RootLayout />,
       children: [
         {
           index: true,
           loader: () => {
             // Redirect to catalog by default
             throw new Response('', {
               status: 302,
               headers: { Location: '/catalog' },
             })
           },
         },
         {
           path: 'catalog',
           element: <CatalogPage />,
         },
         {
           path: 'catalog/:id',
           element: <CatalogDetailPage />,
         },
         {
           path: 'dashboard',
           element: <DashboardPage />,
           loader: protectedLoader,
         },
         {
           path: 'settings',
           element: <div className="p-6">Settings (coming in Phase 7)</div>,
           loader: protectedLoader,
         },
       ],
     },
   ])

   function App() {
     return <RouterProvider router={router} />
   }

   export default App
   ```
  </action>
  <verify>
    cd frontend && npm run build
    grep -r "protectedLoader" src/lib/loaders.ts && echo "Loader OK"
    grep -r "DashboardPage" src/routes/dashboard.tsx && echo "Dashboard OK"
  </verify>
  <done>Protected routes and dashboard page created</done>
</task>

</tasks>

<verification>
- `cd frontend && npm run build` completes without errors
- Navigate to /dashboard while logged out redirects to /login
- Navigate to /dashboard while logged in shows dashboard
- Dashboard shows stats cards (Teams, Skills, MCPs, Tools)
- Available items section shows recent items with "View all" link
- Configuration preview shows inheritance status
- Welcome message includes username
- Loading skeletons show while data fetches
- Error states show if API calls fail
</verification>

<success_criteria>
1. Protected loader redirects unauthenticated users to /login
2. Guest loader redirects authenticated users from login/signup to dashboard
3. Dashboard displays user stats in card grid
4. Available items shows recent catalog items
5. Configuration preview shows effective config with inheritance status
6. All components have loading and error states
7. Username appears in welcome message
</success_criteria>

<output>
After completion, create `.planning/phases/06-web-frontend-core/06-05-SUMMARY.md`
</output>
