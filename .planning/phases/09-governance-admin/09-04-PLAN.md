---
phase: 09-governance-admin
plan: 04
type: execute
wave: 3
depends_on: ["09-02", "09-03"]
files_modified:
  - frontend/src/features/admin/types.ts
  - frontend/src/features/admin/api/index.ts
  - frontend/src/features/admin/hooks/index.ts
  - frontend/src/features/admin/components/TeamList.tsx
  - frontend/src/features/admin/components/TeamForm.tsx
  - frontend/src/features/admin/components/UserList.tsx
  - frontend/src/features/admin/components/UserRoleDialog.tsx
  - frontend/src/pages/AdminTeams.tsx
  - frontend/src/pages/AdminUsers.tsx
  - frontend/src/components/layout/RootLayout.tsx
  - frontend/src/router.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view list of teams in admin panel"
    - "Admin can create new team via form"
    - "Admin can edit team name"
    - "Admin can delete team with confirmation"
    - "Admin can view list of users in admin panel"
    - "Admin can change user role via dialog"
    - "Admin can delete user with confirmation"
    - "Admin navigation appears in layout for admin users"
  artifacts:
    - path: "frontend/src/features/admin/types.ts"
      provides: "TypeScript types for admin feature"
      contains: "interface Team"
    - path: "frontend/src/features/admin/hooks/index.ts"
      provides: "TanStack Query hooks for admin API"
      contains: "useTeams|useUsers"
    - path: "frontend/src/pages/AdminTeams.tsx"
      provides: "Team management page"
      contains: "TeamList"
    - path: "frontend/src/pages/AdminUsers.tsx"
      provides: "User management page"
      contains: "UserList"
  key_links:
    - from: "frontend/src/features/admin/hooks/index.ts"
      to: "/api/v1/admin/teams"
      via: "fetch calls"
      pattern: "api/v1/admin/teams"
    - from: "frontend/src/router.tsx"
      to: "AdminTeams|AdminUsers"
      via: "route definitions"
      pattern: "path.*admin"
---

<objective>
Build admin panel frontend for team and user management

Purpose: Provide UI for admins to manage teams and users without using direct API calls
Output: Admin feature with TeamList, UserList, forms, and dialogs at /admin/teams and /admin/users
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/09-governance-admin/09-02-SUMMARY.md
@.planning/phases/09-governance-admin/09-03-SUMMARY.md
@frontend/src/features/catalog/types.ts
@frontend/src/features/catalog/hooks/index.ts
@frontend/src/router.tsx
@frontend/src/components/layout/RootLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin feature structure with types and API</name>
  <files>
    frontend/src/features/admin/types.ts
    frontend/src/features/admin/api/index.ts
    frontend/src/features/admin/hooks/index.ts
  </files>
  <action>
1. Create features/admin/types.ts:
   - Team: { id: string, name: string, member_ids: string[], created_at: string, updated_at: string }
   - TeamWithMembers: { team: Team, members: User[] }
   - AdminUser: { id: string, email: string, username: string, role: "admin" | "user", team_ids: string[], created_at: string }
   - AdminUserWithTeams: { user: AdminUser, teams: Team[] }
   - PaginatedResponse<T>: { items: T[], total: number, page: number, page_size: number }
   - CreateTeamRequest: { name: string }
   - UpdateTeamRequest: { name: string }
   - AddTeamMemberRequest: { user_id: string }
   - UpdateUserRoleRequest: { role: "admin" | "user" }

2. Create features/admin/api/index.ts with functions:
   - fetchTeams(page, pageSize): GET /api/v1/admin/teams
   - fetchTeam(id): GET /api/v1/admin/teams/{id}
   - createTeam(data): POST /api/v1/admin/teams
   - updateTeam(id, data): PUT /api/v1/admin/teams/{id}
   - deleteTeam(id): DELETE /api/v1/admin/teams/{id}
   - addTeamMember(teamId, userId): POST /api/v1/admin/teams/{id}/members
   - removeTeamMember(teamId, userId): DELETE /api/v1/admin/teams/{id}/members/{userId}
   - fetchUsers(page, pageSize, search?): GET /api/v1/admin/users
   - fetchUser(id): GET /api/v1/admin/users/{id}
   - updateUserRole(id, role): PUT /api/v1/admin/users/{id}/role
   - deleteUser(id): DELETE /api/v1/admin/users/{id}
   Use api client from @/lib/api (same pattern as other features)

3. Create features/admin/hooks/index.ts with TanStack Query hooks:
   - useTeams(page, pageSize) - useQuery
   - useTeam(id) - useQuery
   - useCreateTeam() - useMutation with invalidation
   - useUpdateTeam() - useMutation with invalidation
   - useDeleteTeam() - useMutation with invalidation
   - useAddTeamMember() - useMutation
   - useRemoveTeamMember() - useMutation
   - useUsers(page, pageSize, search) - useQuery
   - useUser(id) - useQuery
   - useUpdateUserRole() - useMutation with invalidation
   - useDeleteUser() - useMutation with invalidation
  </action>
  <verify>
    ls -la /Users/roysarfati/PycharmProjects/atlas/frontend/src/features/admin/
  </verify>
  <done>Admin feature structure created with types, API functions, and hooks</done>
</task>

<task type="auto">
  <name>Task 2: Create team management components and page</name>
  <files>
    frontend/src/features/admin/components/TeamList.tsx
    frontend/src/features/admin/components/TeamForm.tsx
    frontend/src/features/admin/components/TeamMemberManager.tsx
    frontend/src/pages/AdminTeams.tsx
  </files>
  <action>
1. Create TeamList.tsx:
   - Table with columns: Name, Members (count), Created, Actions
   - Actions: Edit (opens form), Delete (confirmation dialog), Manage Members
   - Pagination at bottom
   - Empty state when no teams
   - Loading skeleton while fetching

2. Create TeamForm.tsx:
   - Dialog component for create/edit
   - Name input with validation (required, 3-50 chars)
   - Submit button with loading state
   - Props: open, onClose, team (optional for edit mode)

3. Create TeamMemberManager.tsx:
   - Sheet or dialog showing team members
   - List of current members with remove button
   - Dropdown to add user (searches from all users not in team)
   - Uses useUsers hook with search

4. Create pages/AdminTeams.tsx:
   - Page title "Team Management"
   - "Create Team" button at top right
   - TeamList component
   - TeamForm dialog (controlled by state)
   - TeamMemberManager sheet (controlled by state)
   - Use shadcn/ui components: Card, Table, Button, Dialog, Sheet, Input
  </action>
  <verify>
    ls -la /Users/roysarfati/PycharmProjects/atlas/frontend/src/features/admin/components/ && ls -la /Users/roysarfati/PycharmProjects/atlas/frontend/src/pages/AdminTeams.tsx
  </verify>
  <done>Team management UI complete with list, form, and member manager</done>
</task>

<task type="auto">
  <name>Task 3: Create user management components, page, and routing</name>
  <files>
    frontend/src/features/admin/components/UserList.tsx
    frontend/src/features/admin/components/UserRoleDialog.tsx
    frontend/src/features/admin/components/DeleteUserDialog.tsx
    frontend/src/pages/AdminUsers.tsx
    frontend/src/components/layout/RootLayout.tsx
    frontend/src/router.tsx
  </files>
  <action>
1. Create UserList.tsx:
   - Table with columns: Email, Username, Role (badge), Teams (count), Created, Actions
   - Role badge: admin = red/destructive, user = default
   - Actions: Change Role, Delete
   - Search input for filtering by email/username
   - Pagination at bottom

2. Create UserRoleDialog.tsx:
   - Confirmation dialog showing user info
   - Radio or select to choose new role
   - Warning text about permissions change
   - Submit/Cancel buttons

3. Create DeleteUserDialog.tsx:
   - Confirmation dialog with user info
   - Warning about permanent deletion
   - Type user's email to confirm (like GitHub delete repo)

4. Create pages/AdminUsers.tsx:
   - Page title "User Management"
   - Search input at top
   - UserList component
   - Role dialog (controlled)
   - Delete dialog (controlled)

5. Update RootLayout.tsx:
   - Import useAuthStore to get current user
   - If user.role === "admin", show Admin section in navigation
   - Admin nav items: Teams (/admin/teams), Users (/admin/users)
   - Use Shield icon or similar for admin section

6. Update router.tsx:
   - Add routes: /admin/teams -> AdminTeams, /admin/users -> AdminUsers
   - Wrap in protected loader (same as other protected routes)
   - Consider adding adminLoader that checks role and redirects non-admins
  </action>
  <verify>
    cd /Users/roysarfati/PycharmProjects/atlas/frontend && npm run build 2>&1 | head -20
  </verify>
  <done>User management UI complete, admin routes configured, navigation updated</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` succeeds
2. Routes exist: /admin/teams and /admin/users accessible to admin users
3. Team management: Can create, edit, delete teams; can add/remove members
4. User management: Can view users, change roles, delete users
5. Navigation: Admin section appears for admin users only
6. Responsive: UI works on mobile and desktop
</verification>

<success_criteria>
- Admin can navigate to /admin/teams and /admin/users
- Team CRUD works through UI with proper feedback (toasts)
- Team member management works (add/remove users)
- User list shows all users with search
- Role change works with confirmation
- User deletion requires typing email
- Non-admin users don't see admin navigation
- All forms have proper validation and loading states
</success_criteria>

<output>
After completion, create `.planning/phases/09-governance-admin/09-04-SUMMARY.md`
</output>
