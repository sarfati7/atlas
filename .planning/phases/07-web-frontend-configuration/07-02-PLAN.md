---
phase: 07-web-frontend-configuration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/timeline.tsx
  - frontend/src/features/configuration/components/VersionHistory.tsx
  - frontend/src/features/configuration/components/VersionHistoryItem.tsx
autonomous: true

must_haves:
  truths:
    - "Timeline component follows shadcn/ui patterns"
    - "Version history displays date, message, and SHA"
    - "List is scrollable with vertical layout"
    - "Shows last 10 versions initially with Load more pagination"
  artifacts:
    - path: "frontend/src/components/ui/timeline.tsx"
      provides: "Reusable timeline UI component"
      exports: ["Timeline", "TimelineItem"]
    - path: "frontend/src/features/configuration/components/VersionHistory.tsx"
      provides: "Version history container with Load more"
      exports: ["VersionHistory", "VersionHistorySkeleton"]
    - path: "frontend/src/features/configuration/components/VersionHistoryItem.tsx"
      provides: "Single version row"
      exports: ["VersionHistoryItem"]
  key_links:
    - from: "VersionHistory.tsx"
      to: "timeline.tsx"
      via: "import Timeline components"
      pattern: "from '@/components/ui/timeline'"
    - from: "VersionHistoryItem.tsx"
      to: "TimelineItem"
      via: "renders inside TimelineItem"
      pattern: "<TimelineItem"
---

<objective>
Create timeline UI component and version history display for configuration changes with Load more pagination.

Purpose: Version history shows users all previous versions of their configuration with date, commit message, and SHA. This component will be used in the History tab of settings. Shows last 10 versions initially with Load more button to fetch additional versions.

Output:
- Reusable Timeline UI component (shadcn-style)
- VersionHistory component that fetches and displays versions with pagination
- VersionHistoryItem for individual version rows
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-web-frontend-configuration/07-CONTEXT.md

# Existing UI component patterns
@frontend/src/components/ui/card.tsx
@frontend/src/components/ui/skeleton.tsx

# Types and hooks (created in 07-01 or use backend as reference)
@backend/src/atlas/entrypoints/api/routes/configuration.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Timeline UI component</name>
  <files>
    frontend/src/components/ui/timeline.tsx
  </files>
  <action>
Create `frontend/src/components/ui/timeline.tsx` following shadcn/ui patterns:

```typescript
import * as React from 'react'
import { cn } from '@/lib/utils'

interface TimelineProps extends React.HTMLAttributes<HTMLDivElement> {}

export function Timeline({ className, children, ...props }: TimelineProps) {
  return (
    <div className={cn('relative space-y-4 pl-6', className)} {...props}>
      {/* Vertical line connecting timeline items */}
      <div className="absolute left-[9px] top-2 bottom-2 w-px bg-border" />
      {children}
    </div>
  )
}

interface TimelineItemProps extends React.HTMLAttributes<HTMLDivElement> {
  active?: boolean
}

export function TimelineItem({ className, active, children, ...props }: TimelineItemProps) {
  return (
    <div className={cn('relative', className)} {...props}>
      {/* Circle indicator */}
      <div
        className={cn(
          'absolute -left-6 top-1.5 h-3 w-3 rounded-full border-2',
          active
            ? 'border-primary bg-primary'
            : 'border-muted-foreground bg-background'
        )}
      />
      {children}
    </div>
  )
}
```

This component:
- Uses vertical line with absolute positioning
- TimelineItem has circle indicator that can be active (highlighted) or not
- Follows shadcn pattern of accepting className and HTMLAttributes
- Uses cn() utility for class merging
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes
File exists at `frontend/src/components/ui/timeline.tsx`
  </verify>
  <done>
Timeline and TimelineItem components with active state styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Create VersionHistoryItem component</name>
  <files>
    frontend/src/features/configuration/components/VersionHistoryItem.tsx
  </files>
  <action>
Create `frontend/src/features/configuration/components/VersionHistoryItem.tsx`:

```typescript
import { formatDistanceToNow } from 'date-fns'
import { TimelineItem } from '@/components/ui/timeline'
import type { Version } from '../types'

interface VersionHistoryItemProps {
  version: Version
  isLatest: boolean
  onSelect?: (version: Version) => void
}

export function VersionHistoryItem({ version, isLatest, onSelect }: VersionHistoryItemProps) {
  return (
    <TimelineItem active={isLatest}>
      <div
        className={`p-3 rounded-lg border bg-card ${onSelect ? 'cursor-pointer hover:bg-accent' : ''}`}
        onClick={() => onSelect?.(version)}
      >
        <div className="flex items-start justify-between gap-4">
          <div className="flex-1 min-w-0">
            <p className="font-medium text-foreground truncate">
              {version.message || 'Configuration update'}
            </p>
            <p className="text-sm text-muted-foreground mt-1">
              {version.author} - {formatDistanceToNow(new Date(version.timestamp), { addSuffix: true })}
            </p>
          </div>
          <code className="text-xs text-muted-foreground font-mono bg-muted px-2 py-1 rounded">
            {version.commit_sha.slice(0, 7)}
          </code>
        </div>
        {isLatest && (
          <span className="inline-flex items-center text-xs text-primary mt-2">
            Current version
          </span>
        )}
      </div>
    </TimelineItem>
  )
}
```

This component:
- Shows commit message (with fallback), author, and relative timestamp
- Displays short SHA as monospace code
- Highlights latest version with "Current version" label
- Supports optional onSelect callback for version selection
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes
Component imports TimelineItem correctly
  </verify>
  <done>
Version item shows: message, author, relative time, short SHA
Latest version marked as "Current version"
  </done>
</task>

<task type="auto">
  <name>Task 3: Create VersionHistory container with Load more pagination</name>
  <files>
    frontend/src/features/configuration/components/VersionHistory.tsx
    frontend/src/features/configuration/index.ts
  </files>
  <action>
Create `frontend/src/features/configuration/components/VersionHistory.tsx`:

```typescript
import { useState } from 'react'
import { History, ChevronDown } from 'lucide-react'
import { Timeline } from '@/components/ui/timeline'
import { Skeleton } from '@/components/ui/skeleton'
import { Button } from '@/components/ui/button'
import { useVersionHistory } from '../hooks/useConfiguration'
import { VersionHistoryItem } from './VersionHistoryItem'
import type { Version } from '../types'

const INITIAL_LIMIT = 10
const LOAD_MORE_INCREMENT = 10

interface VersionHistoryProps {
  currentCommitSha?: string  // SHA of current configuration to determine isLatest
  onVersionSelect?: (version: Version) => void
}

export function VersionHistory({ currentCommitSha, onVersionSelect }: VersionHistoryProps) {
  const [limit, setLimit] = useState(INITIAL_LIMIT)
  const { data, isLoading, error, isFetching } = useVersionHistory(limit)

  const handleLoadMore = () => {
    setLimit((prev) => prev + LOAD_MORE_INCREMENT)
  }

  if (isLoading) {
    return <VersionHistorySkeleton />
  }

  if (error) {
    return (
      <div className="text-center py-12 text-destructive">
        <p>Failed to load version history</p>
      </div>
    )
  }

  if (!data?.versions.length) {
    return (
      <div className="text-center py-12 text-muted-foreground">
        <History className="h-8 w-8 mx-auto mb-2 opacity-50" />
        <p>No version history yet</p>
        <p className="text-sm mt-1">Save your configuration to create the first version</p>
      </div>
    )
  }

  const hasMore = data.versions.length < data.total

  return (
    <div className="space-y-4">
      <Timeline>
        {data.versions.map((version, index) => (
          <VersionHistoryItem
            key={version.commit_sha}
            version={version}
            isLatest={currentCommitSha ? version.commit_sha === currentCommitSha : index === 0}
            onSelect={onVersionSelect}
          />
        ))}
      </Timeline>

      {hasMore && (
        <div className="flex justify-center pt-2">
          <Button
            variant="outline"
            size="sm"
            onClick={handleLoadMore}
            disabled={isFetching}
            className="gap-2"
          >
            {isFetching ? (
              'Loading...'
            ) : (
              <>
                <ChevronDown className="h-4 w-4" />
                Load more ({data.total - data.versions.length} remaining)
              </>
            )}
          </Button>
        </div>
      )}
    </div>
  )
}

export function VersionHistorySkeleton() {
  return (
    <div className="space-y-4 pl-6">
      {[1, 2, 3].map((i) => (
        <div key={i} className="relative">
          <Skeleton className="absolute -left-6 top-1.5 h-3 w-3 rounded-full" />
          <div className="p-3 rounded-lg border">
            <Skeleton className="h-4 w-3/4 mb-2" />
            <Skeleton className="h-3 w-1/2" />
          </div>
        </div>
      ))}
    </div>
  )
}
```

Update `frontend/src/features/configuration/index.ts` to export new components:

```typescript
export * from './types'
export * from './hooks/useConfiguration'
export { ConfigurationEditor } from './components/ConfigurationEditor'
export { VersionHistory, VersionHistorySkeleton } from './components/VersionHistory'
export { VersionHistoryItem } from './components/VersionHistoryItem'
```
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes
VersionHistory uses useVersionHistory hook with dynamic limit
Load more button shows remaining count
  </verify>
  <done>
VersionHistory fetches data starting with limit=10
Load more button increments limit by 10
Shows "(N remaining)" count from total
isLatest determined by comparing SHA with currentCommitSha prop
All components exported from feature index
  </done>
</task>

</tasks>

<verification>
All components created and exportable:
```bash
cd frontend && npx tsc --noEmit
```

Component structure:
- Timeline is reusable UI component in components/ui/
- VersionHistory and VersionHistoryItem are feature components
- All exports available from `@/features/configuration`
- Load more pagination working with initial limit of 10
</verification>

<success_criteria>
1. Timeline component renders vertical line with item indicators
2. VersionHistoryItem shows message, author, time, and SHA
3. VersionHistory fetches via useVersionHistory hook starting with limit=10
4. Load more button appears when total > displayed count
5. Load more increments limit by 10 and shows remaining count
6. Empty state shows helpful message with icon
7. Loading state shows skeleton
8. isLatest determined by comparing version SHA with currentCommitSha prop
9. All components exported from feature index
</success_criteria>

<output>
After completion, create `.planning/phases/07-web-frontend-configuration/07-02-SUMMARY.md`
</output>
