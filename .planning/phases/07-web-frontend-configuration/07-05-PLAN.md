---
phase: 07-web-frontend-configuration
plan: 05
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - frontend/package.json
  - frontend/src/features/configuration/components/ImportDropzone.tsx
  - frontend/src/features/configuration/components/ImportTab.tsx
  - frontend/src/features/configuration/components/InheritanceIndicator.tsx
  - frontend/src/routes/settings.tsx
  - frontend/src/features/configuration/index.ts
autonomous: true

must_haves:
  truths:
    - "User can drag-and-drop a .md file to import"
    - "User can click to select file via file picker"
    - "User sees validation status (file type, size)"
    - "User can choose to replace or append content"
    - "User sees inheritance indicator (org/team/user)"
  artifacts:
    - path: "frontend/src/features/configuration/components/ImportDropzone.tsx"
      provides: "File drop zone component"
      exports: ["ImportDropzone"]
    - path: "frontend/src/features/configuration/components/ImportTab.tsx"
      provides: "Import tab with merge options"
      exports: ["ImportTab"]
    - path: "frontend/src/features/configuration/components/InheritanceIndicator.tsx"
      provides: "Shows org/team/user applied badges"
      exports: ["InheritanceIndicator"]
  key_links:
    - from: "ImportDropzone.tsx"
      to: "react-dropzone"
      via: "useDropzone hook"
      pattern: "useDropzone"
    - from: "ImportTab.tsx"
      to: "useImportConfiguration"
      via: "mutation for file upload"
      pattern: "useImportConfiguration\\(\\)"
    - from: "InheritanceIndicator.tsx"
      to: "EffectiveConfiguration"
      via: "displays org/team/user flags"
      pattern: "org_applied|team_applied|user_applied"
---

<objective>
Complete Import tab with file upload and add configuration inheritance display.

Purpose: Users need to import existing claude.md files from their local machine. They also need to see where their configuration comes from (org, team, or personal). This plan completes the Settings page with the final features.

Output:
- ImportDropzone component for drag-and-drop file upload
- ImportTab with replace/append merge options
- InheritanceIndicator showing configuration sources
- Complete Settings page with all three tabs
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-web-frontend-configuration/07-CONTEXT.md

# Existing patterns
@frontend/src/features/profile/types.ts
@frontend/src/features/profile/hooks/useProfile.ts
@frontend/src/routes/settings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-dropzone and create ImportDropzone</name>
  <files>
    frontend/package.json
    frontend/src/features/configuration/components/ImportDropzone.tsx
  </files>
  <action>
Install react-dropzone:
```bash
cd frontend && npm install react-dropzone
```

Create `frontend/src/features/configuration/components/ImportDropzone.tsx`:

```typescript
import { useCallback } from 'react'
import { useDropzone, type FileRejection } from 'react-dropzone'
import { Upload, FileText, AlertCircle, CheckCircle2 } from 'lucide-react'
import { cn } from '@/lib/utils'

interface ImportDropzoneProps {
  onFileAccepted: (file: File) => void
  onFileRejected?: (reason: string) => void
  isUploading?: boolean
  disabled?: boolean
}

export function ImportDropzone({
  onFileAccepted,
  onFileRejected,
  isUploading,
  disabled,
}: ImportDropzoneProps) {
  const onDrop = useCallback(
    (acceptedFiles: File[], rejectedFiles: FileRejection[]) => {
      if (rejectedFiles.length > 0) {
        const rejection = rejectedFiles[0]
        const error = rejection.errors[0]

        if (error.code === 'file-too-large') {
          onFileRejected?.('File must be less than 1MB')
        } else if (error.code === 'file-invalid-type') {
          onFileRejected?.('File must be a .md file')
        } else {
          onFileRejected?.(error.message)
        }
        return
      }

      if (acceptedFiles.length > 0) {
        onFileAccepted(acceptedFiles[0])
      }
    },
    [onFileAccepted, onFileRejected]
  )

  const { getRootProps, getInputProps, isDragActive, isDragReject, acceptedFiles } =
    useDropzone({
      onDrop,
      accept: {
        'text/markdown': ['.md'],
        'text/plain': ['.md'],
      },
      maxFiles: 1,
      maxSize: 1024 * 1024, // 1MB (matches backend limit)
      disabled: isUploading || disabled,
    })

  const hasFile = acceptedFiles.length > 0

  return (
    <div
      {...getRootProps()}
      className={cn(
        'border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors',
        isDragActive && !isDragReject && 'border-primary bg-primary/5',
        isDragReject && 'border-destructive bg-destructive/5',
        !isDragActive && !hasFile && 'border-border hover:border-muted-foreground',
        hasFile && 'border-primary/50 bg-primary/5',
        (isUploading || disabled) && 'opacity-50 cursor-not-allowed'
      )}
    >
      <input {...getInputProps()} />
      <div className="flex flex-col items-center gap-3">
        {hasFile ? (
          <>
            <CheckCircle2 className="h-10 w-10 text-primary" />
            <div>
              <p className="font-medium text-foreground">{acceptedFiles[0].name}</p>
              <p className="text-sm text-muted-foreground">
                {(acceptedFiles[0].size / 1024).toFixed(1)} KB
              </p>
            </div>
          </>
        ) : isDragReject ? (
          <>
            <AlertCircle className="h-10 w-10 text-destructive" />
            <p className="text-sm text-destructive">Invalid file type</p>
          </>
        ) : isDragActive ? (
          <>
            <FileText className="h-10 w-10 text-primary" />
            <p className="text-sm text-muted-foreground">Drop the file here</p>
          </>
        ) : (
          <>
            <Upload className="h-10 w-10 text-muted-foreground" />
            <div>
              <p className="text-foreground">
                Drag and drop your claude.md file here
              </p>
              <p className="text-sm text-muted-foreground mt-1">
                or click to select a file
              </p>
            </div>
            <div className="flex items-center gap-4 text-xs text-muted-foreground mt-2">
              <span className="flex items-center gap-1">
                <CheckCircle2 className="h-3 w-3" /> .md files only
              </span>
              <span className="flex items-center gap-1">
                <CheckCircle2 className="h-3 w-3" /> Max 1MB
              </span>
            </div>
          </>
        )}
      </div>
    </div>
  )
}
```
  </action>
  <verify>
`npm list react-dropzone` shows installed
`cd frontend && npx tsc --noEmit` passes
  </verify>
  <done>
ImportDropzone with:
- Drag-and-drop zone
- File picker on click
- Validation feedback (file type, size)
- Visual states for drag, reject, accepted
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ImportTab with merge options</name>
  <files>
    frontend/src/features/configuration/components/ImportTab.tsx
  </files>
  <action>
Create `frontend/src/features/configuration/components/ImportTab.tsx`:

```typescript
import { useState } from 'react'
import { FileUp, Replace, PlusCircle } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog'
import { ImportDropzone } from './ImportDropzone'
import { useImportConfiguration, useDraftStore } from '../index'

interface ImportTabProps {
  hasExistingContent: boolean
  onImportSuccess: () => void
}

type MergeMode = 'replace' | 'append'

export function ImportTab({ hasExistingContent, onImportSuccess }: ImportTabProps) {
  const [selectedFile, setSelectedFile] = useState<File | null>(null)
  const [fileContent, setFileContent] = useState<string>('')
  const [error, setError] = useState<string | null>(null)
  const [showMergeDialog, setShowMergeDialog] = useState(false)

  const importConfig = useImportConfiguration()
  const { content: currentContent, setOriginalContent } = useDraftStore()

  const handleFileAccepted = async (file: File) => {
    setError(null)
    setSelectedFile(file)

    // Read file content
    try {
      const text = await file.text()
      setFileContent(text)

      // If user has existing content, show merge dialog
      if (hasExistingContent && currentContent.trim()) {
        setShowMergeDialog(true)
      } else {
        // No existing content, just import
        handleImport('replace', text)
      }
    } catch (err) {
      setError('Failed to read file')
      setSelectedFile(null)
    }
  }

  const handleFileRejected = (reason: string) => {
    setError(reason)
    setSelectedFile(null)
  }

  const handleImport = async (mode: MergeMode, content?: string) => {
    const contentToUse = content ?? fileContent
    setShowMergeDialog(false)

    if (mode === 'append' && currentContent.trim()) {
      // Append: merge new content after existing
      const mergedContent = `${currentContent.trim()}\n\n---\n\n${contentToUse}`
      // Update draft store directly for append mode
      setOriginalContent(mergedContent)
      setSelectedFile(null)
      onImportSuccess()
    } else {
      // Replace: use the import endpoint which creates a git commit
      if (selectedFile) {
        importConfig.mutate(selectedFile, {
          onSuccess: () => {
            setSelectedFile(null)
            setFileContent('')
            onImportSuccess()
          },
          onError: (err) => {
            setError(err instanceof Error ? err.message : 'Import failed')
          },
        })
      }
    }
  }

  const handleClearFile = () => {
    setSelectedFile(null)
    setFileContent('')
    setError(null)
  }

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <FileUp className="h-5 w-5" />
            Import Configuration
          </CardTitle>
          <CardDescription>
            Upload an existing claude.md file to use as your configuration
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <ImportDropzone
            onFileAccepted={handleFileAccepted}
            onFileRejected={handleFileRejected}
            isUploading={importConfig.isPending}
          />

          {error && (
            <p className="text-sm text-destructive">{error}</p>
          )}

          {selectedFile && !showMergeDialog && (
            <div className="flex items-center justify-between p-3 rounded-lg bg-muted">
              <span className="text-sm">{selectedFile.name}</span>
              <Button variant="ghost" size="sm" onClick={handleClearFile}>
                Clear
              </Button>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Merge mode dialog */}
      <AlertDialog open={showMergeDialog} onOpenChange={setShowMergeDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Import Options</AlertDialogTitle>
            <AlertDialogDescription>
              You already have configuration content. How would you like to import the new file?
            </AlertDialogDescription>
          </AlertDialogHeader>
          <div className="grid gap-3 py-4">
            <Button
              variant="outline"
              className="justify-start gap-3 h-auto py-3"
              onClick={() => handleImport('replace')}
              disabled={importConfig.isPending}
            >
              <Replace className="h-5 w-5" />
              <div className="text-left">
                <p className="font-medium">Replace</p>
                <p className="text-sm text-muted-foreground">
                  Replace current content with imported file
                </p>
              </div>
            </Button>
            <Button
              variant="outline"
              className="justify-start gap-3 h-auto py-3"
              onClick={() => handleImport('append')}
              disabled={importConfig.isPending}
            >
              <PlusCircle className="h-5 w-5" />
              <div className="text-left">
                <p className="font-medium">Append</p>
                <p className="text-sm text-muted-foreground">
                  Add imported content after existing configuration
                </p>
              </div>
            </Button>
          </div>
          <AlertDialogFooter>
            <AlertDialogCancel onClick={handleClearFile}>Cancel</AlertDialogCancel>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  )
}
```
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes
Component shows merge dialog when existing content exists
  </verify>
  <done>
ImportTab with:
- ImportDropzone for file selection
- Merge dialog (Replace/Append) when existing content
- Replace mode uses import API endpoint
- Append mode updates draft store directly
  </done>
</task>

<task type="auto">
  <name>Task 3: Create InheritanceIndicator and complete Settings page</name>
  <files>
    frontend/src/features/configuration/components/InheritanceIndicator.tsx
    frontend/src/features/configuration/index.ts
    frontend/src/routes/settings.tsx
  </files>
  <action>
Create `frontend/src/features/configuration/components/InheritanceIndicator.tsx`:

```typescript
import { Building2, Users, User } from 'lucide-react'
import { Badge } from '@/components/ui/badge'

interface InheritanceIndicatorProps {
  orgApplied: boolean
  teamApplied: boolean
  userApplied: boolean
}

export function InheritanceIndicator({
  orgApplied,
  teamApplied,
  userApplied,
}: InheritanceIndicatorProps) {
  const sources = [
    { applied: orgApplied, label: 'Organization', icon: Building2 },
    { applied: teamApplied, label: 'Team', icon: Users },
    { applied: userApplied, label: 'Personal', icon: User },
  ]

  const appliedSources = sources.filter((s) => s.applied)

  if (appliedSources.length === 0) {
    return null
  }

  return (
    <div className="flex items-center gap-2">
      <span className="text-sm text-muted-foreground">Configuration from:</span>
      <div className="flex gap-1">
        {sources.map((source) => {
          const Icon = source.icon
          return (
            <Badge
              key={source.label}
              variant={source.applied ? 'default' : 'outline'}
              className={`gap-1 ${source.applied ? '' : 'opacity-40'}`}
            >
              <Icon className="h-3 w-3" />
              {source.label}
            </Badge>
          )
        })}
      </div>
    </div>
  )
}
```

Update `frontend/src/features/configuration/index.ts` with all exports:

```typescript
export * from './types'
export * from './hooks/useConfiguration'
export { useDraftStore } from './stores/draftStore'
export { ConfigurationEditor } from './components/ConfigurationEditor'
export { VersionHistory, VersionHistorySkeleton } from './components/VersionHistory'
export { VersionHistoryItem } from './components/VersionHistoryItem'
export { VersionDetail } from './components/VersionDetail'
export { HistoryTab } from './components/HistoryTab'
export { ImportDropzone } from './components/ImportDropzone'
export { ImportTab } from './components/ImportTab'
export { InheritanceIndicator } from './components/InheritanceIndicator'
```

Update `frontend/src/routes/settings.tsx` to complete all tabs:

```typescript
import { useEffect } from 'react'
import { Save, AlertTriangle } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Card, CardContent } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'
import {
  ConfigurationEditor,
  useConfiguration,
  useUpdateConfiguration,
  useDraftStore,
  HistoryTab,
  ImportTab,
  InheritanceIndicator,
} from '@/features/configuration'
import { useEffectiveConfiguration } from '@/features/profile/hooks/useProfile'

function EditorSkeleton() {
  return (
    <div className="space-y-4">
      <Skeleton className="h-[500px] w-full rounded-lg" />
    </div>
  )
}

function EditorError({ onRetry }: { onRetry: () => void }) {
  return (
    <Card className="border-destructive/50 bg-destructive/10">
      <CardContent className="flex items-center gap-4 py-4">
        <AlertTriangle className="h-5 w-5 text-destructive" />
        <div className="flex-1">
          <p className="text-sm text-destructive">Failed to load configuration</p>
        </div>
        <Button variant="outline" size="sm" onClick={onRetry}>
          Retry
        </Button>
      </CardContent>
    </Card>
  )
}

export function SettingsPage() {
  const { data: config, isLoading, error, refetch } = useConfiguration()
  const { data: effective } = useEffectiveConfiguration()
  const updateConfig = useUpdateConfiguration()

  const { content, isDirty, setContent, setOriginalContent } = useDraftStore()

  // Sync server config to draft store on load
  useEffect(() => {
    if (config?.content !== undefined) {
      setOriginalContent(config.content)
    }
  }, [config?.content, setOriginalContent])

  // Warn on browser close/reload with unsaved changes
  useEffect(() => {
    const handleBeforeUnload = (e: BeforeUnloadEvent) => {
      if (isDirty) {
        e.preventDefault()
        e.returnValue = ''
      }
    }
    window.addEventListener('beforeunload', handleBeforeUnload)
    return () => window.removeEventListener('beforeunload', handleBeforeUnload)
  }, [isDirty])

  const handleSave = () => {
    updateConfig.mutate(
      { content },
      {
        onSuccess: (newConfig) => {
          setOriginalContent(newConfig.content)
        },
      }
    )
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="container mx-auto max-w-5xl px-4 py-8">
        {/* Header with save button */}
        <header className="mb-6 flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-semibold text-foreground">Settings</h1>
            <p className="text-muted-foreground">Manage your claude.md configuration</p>
          </div>
          <Button
            onClick={handleSave}
            disabled={!isDirty || updateConfig.isPending}
            className="gap-2"
          >
            <Save className="h-4 w-4" />
            {updateConfig.isPending ? 'Saving...' : 'Save'}
          </Button>
        </header>

        {/* Inheritance indicator */}
        {effective && (
          <div className="mb-4">
            <InheritanceIndicator
              orgApplied={effective.org_applied}
              teamApplied={effective.team_applied}
              userApplied={effective.user_applied}
            />
          </div>
        )}

        {/* Dirty indicator */}
        {isDirty && (
          <div className="mb-4 flex items-center gap-2 text-sm text-amber-500">
            <div className="h-2 w-2 rounded-full bg-amber-500" />
            Unsaved changes
          </div>
        )}

        {/* Tabs */}
        <Tabs defaultValue="editor" className="space-y-4">
          <TabsList>
            <TabsTrigger value="editor">Editor</TabsTrigger>
            <TabsTrigger value="history">History</TabsTrigger>
            <TabsTrigger value="import">Import</TabsTrigger>
          </TabsList>

          <TabsContent value="editor">
            {error ? (
              <EditorError onRetry={refetch} />
            ) : isLoading ? (
              <EditorSkeleton />
            ) : (
              <ConfigurationEditor value={content} onChange={setContent} />
            )}
          </TabsContent>

          <TabsContent value="history">
            <HistoryTab
              isDirty={isDirty}
              onRollbackSuccess={() => {
                refetch()
              }}
            />
          </TabsContent>

          <TabsContent value="import">
            <ImportTab
              hasExistingContent={!!content.trim()}
              onImportSuccess={() => {
                refetch()
              }}
            />
          </TabsContent>
        </Tabs>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
`cd frontend && npx tsc --noEmit` passes
All three tabs are functional
InheritanceIndicator shows when effective config loaded
  </verify>
  <done>
Complete Settings page with:
- Editor tab with Monaco editor
- History tab with version list and rollback
- Import tab with dropzone and merge options
- Inheritance indicator showing org/team/user sources
  </done>
</task>

</tasks>

<verification>
All Phase 7 success criteria met:
```bash
cd frontend && npx tsc --noEmit
```

Manual verification:
1. Edit configuration in Monaco editor - Save button works
2. View version history - list shows versions
3. Click version, rollback - content restored
4. Import .md file - merge dialog appears if content exists
5. Inheritance indicator shows which levels apply
</verification>

<success_criteria>
1. react-dropzone installed
2. ImportDropzone handles drag-and-drop with validation
3. ImportTab shows merge options (Replace/Append)
4. InheritanceIndicator shows org/team/user badges
5. Settings page has all three tabs working
6. All Phase 7 success criteria from ROADMAP.md verified
</success_criteria>

<output>
After completion, create `.planning/phases/07-web-frontend-configuration/07-05-SUMMARY.md`
</output>
